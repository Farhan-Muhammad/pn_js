<p>The PubNub Storage and Playback Service provides realtime access to history for all messages published to PubNub. Each published message is timestamped to the nearest 10 nanoseconds, and is stored across multiple availability zones in several geographical data center locations. Stored messages can be encrypted with AES-256 message encryption, ensuring that they are not readable while stored on PubNub's network.</p><p>Messages can be stored for a configurable duration or forever, as controlled by the retention policy that is configured on your account. The following options are available: 1 day, 7 days, 1 month, and Forever.</p><hr><h2 class="inpage-link tag-link main-placeholder inline">History</h2><div class="custom-popup-main"><span class="popup-button">Requires <i>Storage &amp; Playback</i> add-on</span><span class="popup-content"> <a title="Close" href="javascript:void(0)" class="custom-popup-close">X</a><span class="inner-content">Requires that the Storage &amp; Playback add-on is enabled for your key. See this page on enabling add-on features on your keys:<br><br><a href="/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys" target="_blank" title="Open in New window">http://www.pubnub.com/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys</a>.</span></span></div><h3 class="inpage-link tag-link">Description</h3><div>This function fetches historical messages of a channel.</div><div>It is possible to control how messages are returned and in what order, for example you can:</div><ul><li>Search for messages starting on the newest end of the timeline (default behavior - <code>reverse</code> = <code>false</code>)</li><li>Search for messages from the oldest end of the timeline by setting <code>reverse</code> to <code>true</code>.</li><li>Page through results by providing a <code>start</code> OR <code>end</code> time token.</li><li>Retrieve a <i>slice</i> of the time line by providing both a <code>start</code> AND <code>end</code> time token.</li><li>Limit the number of messages to a specific quantity using the <code>count</code> parameter.</li></ul><table class="table-icon-tip"><tbody><tr><td class="icon"><i class="fa icon icon-tip" title="tip"> &nbsp; </i></td><td><div class="title-heading">Start &amp; End parameter usage clarity:</div><div>If only the <code>start</code> parameter is specified (without <code>end</code>), you will receive messages that are <b>older</b> than and up to that <code>start</code> timetoken value.</div><div>If only the <code>end</code> parameter is specified (without <code>start</code>) you will receive messages that match that <code>end</code> timetoken value and <b>newer</b>.</div><div>Specifying values for both <code>start</code> <i>and</i> <code>end</code> parameters will return messages between those timetoken values (inclusive on the <code>end</code> value).</div><div>Keep in mind that you will still receive a maximum of 100 messages even if there are more messages that meet the timetoken values. Iterative calls to history adjusting the <code>start</code> timetoken is necessary to page through the full set of results if more than 100 messages meet the timetoken values.</div></td></tr></tbody></table><h3 class="inpage-link tag-link">Method(s)</h3><div>To run <code>History</code> you can use the following method(s) in the JavaScript V4 SDK</div><ol class="ol-margin-extra"><li><div> <code class="inpage-plink tag-link padding-left-0"><a class="title-red" href="#history-with-metadata-arg" data-id="history-with-metadata-arg-" title="History with metadata Argument" id="history-with-metadata-arg-">history( <span class="margin-left-1">{String <code>channel</code>, Boolean <code>reverse</code>, Number <code>count</code>, Boolean <code>stringifiedTimeToken</code>, Boolean <code>includeMeta</code>, String <code>start</code>, String <code>end</code>},</span> <span class="margin-left-1">Function <code>callback</code></span> )</a></code></div><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Defaults</th><th>Description</th></tr></thead><tbody><tr><td>Operation Arguments</td><td>Hash</td><td>Yes</td><td></td><td>A hash of arguments.</td></tr><tr><td><code class="margin-left-1">channel</code></td><td>String</td><td>Yes</td><td></td><td>Specifies <code>channel</code> to return history messages from.</td></tr><tr><td><code class="margin-left-1">reverse</code></td><td>Boolean</td><td>Optional</td><td><code>false</code></td><td><p>Setting to <code>true</code> will traverse the <code>time</code> line in <code>reverse</code> starting with the oldest <code>message</code> first.</p><br><p>If both <code>start</code> and <code>end</code> arguments are provided, <code>reverse</code> is ignored and messages are returned starting with the newest <code>message</code>.</p></td></tr><tr><td><code class="margin-left-1">count</code></td><td>Number</td><td>Optional</td><td><code>100</code></td><td>Specifies the number of historical messages to return.<br> <br> Default/Maximum is <code>100</code>.</td></tr><tr><td><code class="margin-left-1">stringified<wbr>TimeToken</code></td><td>Boolean</td><td>Optional</td><td><code>false</code></td><td>If <code>stringifiedTimeToken</code> is specified as <code>true</code>, the SDK will return <code>timetoken</code> values as a strings instead of integers. Usage of setting is encouraged in javascript environments which perform round-up/down on large integers.</td></tr><tr><td><code class="margin-left-1">includeMeta</code></td><td>Boolean</td><td>Optional</td><td></td><td>Whether message meta information should be fetched or not.</td></tr><tr><td><code class="margin-left-1">start</code></td><td>String</td><td>Optional</td><td></td><td>Time token delimiting the <code>start</code> of <code>time</code> slice (exclusive) to pull messages from.</td></tr><tr><td><code class="margin-left-1">end</code></td><td>String</td><td>Optional</td><td></td><td>Time token delimiting the <code>end</code> of <code>time</code> slice (inclusive) to pull messages from.</td></tr><tr><td><code>callback</code></td><td>Function</td><td>Optional</td><td></td><td>Executes on a successful/unsuccessful <code>history</code>.</td></tr></tbody></table></div></li></ol><h3 class="inpage-link tag-link">Basic Usage</h3><div>Retrieve the last 100 messages on a channel:</div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'history_channel'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">count</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// how many items to fetch</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Response</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment">// Example of Status</span>
<span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">operation</span><span class="token operator">:</span> <span class="token string">"PNHistoryOperation"</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">statusCode</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span>

<span class="token comment">// Example of Response</span>
<span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">endTimeToken</span><span class="token operator">:</span> <span class="token string">"14867650866860159"</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token pn-variable pn-before-colon">timetoken</span><span class="token operator">:</span> <span class="token string">"14867650866860159"</span><span class="token punctuation">,</span>
            <span class="token pn-variable pn-before-colon">entry</span><span class="token operator">:</span> <span class="token string">"[User 636] hello World"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">startTimeToken</span><span class="token operator">:</span> <span class="token string">"14867650866860159"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Other Examples</h3><ol class="ol-margin-extra"><li><div class="inpage-plink tag-link"><a href="#history-oldest-messages" data-id="history-oldest-messages-" class="title-red" id="history-oldest-messages-">Use <code>history()</code> to retrieve the three oldest messages by retrieving from the time line in reverse:</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Setting to true will traverse the time line in reverse starting with the oldest message first.</span>
        <span class="token pn-variable pn-before-colon">count</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// how many items to fetch</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// false is the default</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><div class="inpage-plink tag-link"><a href="#history-newest-messages" data-id="history-newest-messages-" class="title-red" id="history-newest-messages-">Use <code>history()</code> to retrieve messages newer than a given time token by paging from oldest message to newest message starting at a single point in time (exclusive):</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Setting to true will traverse the time line in reverse starting with the oldest message first.</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
        <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">'13406746780720711'</span> <span class="token comment">// start time token to fetch</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><div class="inpage-plink tag-link"><a href="#history-example-3" data-id="history-example-3-" class="title-red" id="history-example-3-">Use <code><code>history()</code></code> to retrieve messages until a given time token by paging from newest message to oldest message until a specific end point in time (inclusive):</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
        <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">'13406746780720711'</span> <span class="token comment">// start time token to fetch</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-plink tag-link"><a href="#history_example_4" data-id="history_example_4-" class="title-red" id="history_example_4-">History Paging Example</a></div><table class="table-icon-note"><tbody><tr><td class="icon"><i class="fa icon icon-note" title="note">&nbsp;</i></td><td><div class="title-heading">Usage!</div><div>You can call the method by passing 0 or a valid <b>time token</b> as the argument.</div></td></tr></tbody></table>

<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function-variable function pn-before-equal">getAllMessages</span> <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">timetoken</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'history_test'</span><span class="token punctuation">,</span>
            <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
            <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token pn-variable">timetoken</span> <span class="token comment">// start time token to fetch</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">msgs</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">messages</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">start</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">startTimeToken</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">end</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">endTimeToken</span><span class="token punctuation">;</span>
            <span class="token comment">// if msgs were retrieved, do something useful with them</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token pn-variable">msgs</span> <span class="token operator">!=</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> <span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"start : "</span> <span class="token operator">+</span> <span class="token pn-variable">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"end : "</span> <span class="token operator">+</span> <span class="token pn-variable">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// if 100 msgs were retrieved, there might be more; call history again</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-before-equal pn-after-dot">length</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token function">getAllMessages</span><span class="token punctuation">(</span><span class="token pn-variable">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">//Usage examples:</span>
<span class="token comment">//getAllMessages();</span>
<span class="token comment">//getAllMessages(null);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

&nbsp;</li><li><div class="inpage-plink tag-link"><a href="#history-basic-usage-using-promises" data-id="history-basic-usage-using-promises-" title="Basic usage using Promises" class="title-red" id="history-basic-usage-using-promises-">Basic usage using Promises</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'history_channel'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Setting to true will traverse the time line in reverse starting with the oldest message first.</span>
    <span class="token pn-variable pn-before-colon">count</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// how many items to fetch</span>
    <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
    <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">'123123123123'</span><span class="token punctuation">,</span> <span class="token comment">// start time token to fetch</span>
    <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">'123123123133'</span> <span class="token comment">// end timetoken to fetch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">error</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-plink tag-link"><a href="#history-oldest-msg-using-promises" data-id="history-oldest-msg-using-promises-" class="title-red" title="Using History to retrive three oldest messages" id="history-oldest-msg-using-promises-">Use <code>history()</code> to retrieve the three oldest messages by retrieving from the time line in reverse using Promises:</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Setting to true will traverse the time line in reverse starting with the oldest message first.</span>
    <span class="token pn-variable pn-before-colon">count</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// how many items to fetch</span>
    <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// false is the default</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">error</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-plink tag-link"><a href="#history-oldest-newest-msg-using-promises" data-id="history-oldest-newest-msg-using-promises-" class="title-red" id="history-oldest-newest-msg-using-promises-">Use <code>history()</code> to retrieve messages newer than a given time token by paging from oldest message to newest message starting at a single point in time (exclusive) using Promises:</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">reverse</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Setting to true will traverse the time line in reverse starting with the oldest message first.</span>
    <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
    <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">'13406746780720711'</span> <span class="token comment">// start time token to fetch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">error</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-plink tag-link"><a href="#history-newest-oldest-msg-using-promises" data-id="history-newest-oldest-msg-using-promises-" class="title-red" id="history-newest-oldest-msg-using-promises-">Use <code><code>history()</code></code> to retrieve messages until a given time token by paging from newest message to oldest message until a specific end point in time (inclusive) using Promises:</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
    <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">'13406746780720711'</span> <span class="token comment">// start time token to fetch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">error</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-plink tag-link"><a href="#history-paging-response-using-promises" data-id="history-paging-response-using-promises-" class="title-red" id="history-paging-response-using-promises-">Paging History Responses using Promises:</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword keyword-function">function</span> <span class="token function">getAllMessages</span><span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">timetoken</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
		<span class="token punctuation">{</span>
			<span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'history_test'</span><span class="token punctuation">,</span>
			<span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// false is the default</span>
			<span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token pn-variable">timetoken</span> <span class="token comment">// start time token to fetch</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">msgs</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">messages</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">start</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">startTimeToken</span><span class="token punctuation">;</span>
			<span class="token keyword keyword-var">var</span> <span class="token pn-variable pn-before-equal">end</span> <span class="token operator">=</span> <span class="token pn-variable">response</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">endTimeToken</span><span class="token punctuation">;</span>

			<span class="token comment">// if msgs were retrieved, do something useful with them</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token pn-variable">msgs</span> <span class="token operator">!==</span> <span class="token keyword keyword-undefined">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-after-dot">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"start : "</span> <span class="token operator">+</span> <span class="token pn-variable">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"end : "</span> <span class="token operator">+</span> <span class="token pn-variable">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// if 100 msgs were retrieved, there might be more; call history again</span>
			<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token pn-variable">msgs</span><span class="token punctuation">.</span><span class="token pn-variable pn-before-equal pn-after-dot">length</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">getAllMessages</span><span class="token punctuation">(</span><span class="token pn-variable">start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//Usage examples:</span>
<span class="token comment">//getAllMessages();</span>
<span class="token comment">//getAllMessages(null);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li><li><div class="inpage-link tag-link"> <a href="#fetch-messages-with-metadata" data-id="fetch-messages-with-metadata-" class="title-heading" title="Fetch messages with metadata" id="fetch-messages-with-metadata-"> Fetch messages with metadata </a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'my_channel'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">includeMeta</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li></ol><hr><h2 class="inpage-link tag-link main-placeholder inline">Batch History</h2><div class="custom-popup-main"><span class="popup-button">Requires <i>Storage &amp; Playback</i> add-on</span><span class="popup-content"> <a title="Close" href="javascript:void(0)" class="custom-popup-close">X</a><span class="inner-content">Requires that the Storage &amp; Playback add-on is enabled for your key. See this page on enabling add-on features on your keys:<br><br><a href="/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys" target="_blank" title="Open in New window">http://www.pubnub.com/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys</a>.</span></span></div><h3 class="inpage-link tag-link">Description</h3><p>This function fetches historical messages from multiple channels. The <code>includeMessageActions</code> or <code>includeActions</code> flag also allows you to fetch message actions along with the messages.</p><p>It's possible to control how messages are returned and in what order. For example, you can:</p><ul><li>Search for messages starting on the newest end of the timeline.</li><li>Search for messages from the oldest end of the timeline.</li><li>Page through results by providing a <code>start</code> OR <code>end</code> time token.</li><li>Retrieve a <i>slice</i> of the time line by providing both a <code>start</code> AND <code>end</code> time token.</li><li>Retrieve a specific (maximum) number of messages using the <code>count</code> parameter.</li></ul><p>Batch history returns up to 100 messages on a single channel, or 25 per channel on a maximum of 500 channels. Use the <code>start</code> and <code>end</code> timestamps to page through the next batch of messages.</p><table class="table-icon-tip custom-label"><tbody><tr><td class="icon"><i class="fa icon icon-tip" title="tip">Start and End parameter usage clarity</i></td><td><p>If you specify only the <code>start</code> parameter (without <code>end</code>), you will receive messages that are older than the <code>start</code> timetoken.</p><p>If you specify only the <code>end</code> parameter (without <code>start</code>), you will receive messages from that <code>end</code> timetoken and newer.</p><p>Specify values for both <code>start</code> and <code>end</code> parameters to retrieve messages between those timetokens (inclusive of the <code>end</code> value).</p><p>Keep in mind that you will still receive a maximum of 100 messages (or 25, for multiple channels) even if there are more messages that meet the timetoken values. Iterative calls to history adjusting the <code>start</code> timetoken are necessary to page through the full set of results if more messages meet the timetoken values.</p></td></tr></tbody></table><h3 class="inpage-link tag-link">Method(s)</h3><div>To run <code>Fetch History</code>, you can use the following method(s) in the JavaScript V4 SDK:</div><ol class="ol-margin-extra"><li><div> <code class="inpage-plink tag-link padding-left-0"><a class="title-red" href="#fetch-messages-with-metadata-and-actions-arg" data-id="fetch-messages-with-metadata-and-actions-arg-" title="Fetch History Argument" id="fetch-messages-with-metadata-and-actions-arg-">fetchMessages(<br> &nbsp;&nbsp;&nbsp;&nbsp;{Array <code>channels</code>, Number <code>count</code>, Boolean <code>stringifiedTimeToken</code>, Boolean <code>includeMeta</code>, Boolean <code>includeMessageType</code>, Boolean <code>includeUUID</code>, Boolean <code>includeMessageActions</code>, String <code>start</code>, String <code>end</code>},<br> &nbsp;&nbsp;&nbsp;&nbsp;Function callback<br> )</a></code></div><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Defaults</th><th>Description</th></tr></thead><tbody><tr><td>Operation Arguments</td><td>Hash</td><td>Yes</td><td></td><td>A hash of arguments.</td></tr><tr><td><code class="margin-left-1">channels</code></td><td>Array</td><td>Yes</td><td></td><td>Specifies <code>channels</code> to return history messages from.</td></tr><tr><td><code class="margin-left-1">count</code></td><td>Number</td><td>Optional</td><td><code>25</code></td><td>Specifies the number of historical messages to return per channel.<br> <br> Default/Maximum is <code>25</code> per <code>channel</code>.</td></tr><tr><td><code class="margin-left-1">stringified<wbr>TimeToken</code></td><td>Boolean</td><td>Optional</td><td><code>false</code></td><td>If <code>stringifiedTimeToken</code> is specified as <code>true</code>, the SDK will return <code>timetoken</code> values as a strings instead of integers. Usage of setting is encouraged in javascript environments which perform round-up/down on large integers.</td></tr><tr><td><code class="margin-left-1">includeMessageType</code></td><td>Boolean</td><td>Optional</td><td><code>true</code></td><td>Pass <code>true</code> to receive the message type with each history message.</td></tr><tr><td><code class="margin-left-1">includeUUID</code></td><td>Boolean</td><td>Optional</td><td><code>true</code></td><td>Pass <code>true</code> to receive the publisher <code>uuid</code> with each history message.</td></tr><tr><td><code class="margin-left-1">includeMeta</code></td><td>Boolean</td><td>Optional</td><td></td><td>Whether message meta information should be fetched or not.</td></tr><tr><td><code class="margin-left-1">includeMessage<wbr>Actions</code></td><td>Boolean</td><td>Optional</td><td></td><td>Whether message added message actions should be fetched or not.<br> <br> Throws an exception in case if API called with more than one <code>channel</code>.</td></tr><tr><td><code class="margin-left-1">start</code></td><td>String</td><td>Optional</td><td></td><td>Time token delimiting the <code>start</code> of <code>time</code> slice (exclusive) to pull messages from.</td></tr><tr><td><code class="margin-left-1">end</code></td><td>String</td><td>Optional</td><td></td><td>Time token delimiting the <code>end</code> of <code>time</code> slice (inclusive) to pull messages from.</td></tr><tr><td><code>callback</code></td><td>Function</td><td>Optional</td><td></td><td>Executes on a successful/unsuccessful <code>fetchMessages</code>.</td></tr></tbody></table></div></li></ol><h3 class="inpage-link tag-link">Basic Usage</h3><div>Retrieve the last message on a channel:</div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment">// assuming pubnub is an initialized instance</span>
<span class="token comment">// start, end, count are optional</span>
<span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">fetchMessages</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        <span class="token pn-variable pn-before-colon">channels</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ch1'</span><span class="token punctuation">,</span> <span class="token string">'ch2'</span><span class="token punctuation">,</span> <span class="token string">'ch3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
        <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">"15343325214676133"</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">"15343325004275466"</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">count</span><span class="token operator">:</span> <span class="token number">25</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Response</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment">//Example of status</span>
<span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">operation</span><span class="token operator">:</span> <span class="token string">'PNFetchMessagesOperation'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">statusCode</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span>

<span class="token comment">//Example of response</span>
<span class="token punctuation">{</span>
    <span class="token string">"channels"</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">"my-channel"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"message"</span><span class="token operator">:</span><span class="token string">"message_1"</span><span class="token punctuation">,</span>
                <span class="token string">"timetoken"</span><span class="token operator">:</span><span class="token string">"15483367794816642"</span><span class="token punctuation">,</span>
                <span class="token string">"uuid"</span><span class="token operator">:</span><span class="token string">"my-uuid"</span><span class="token punctuation">,</span>
                <span class="token string">"message_type"</span><span class="token operator">:</span><span class="token keyword keyword-null">null</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"message"</span><span class="token operator">:</span><span class="token string">"message_2"</span><span class="token punctuation">,</span>
                <span class="token string">"timetoken"</span><span class="token operator">:</span><span class="token string">"15483367810978163"</span><span class="token punctuation">,</span>
                <span class="token string">"uuid"</span><span class="token operator">:</span><span class="token string">"my-uuid"</span><span class="token punctuation">,</span>
                <span class="token string">"message_type"</span><span class="token operator">:</span><span class="token keyword keyword-null">null</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"my-channel-2"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"message"</span><span class="token operator">:</span><span class="token string">"message_1"</span><span class="token punctuation">,</span>
                <span class="token string">"timetoken"</span><span class="token operator">:</span><span class="token string">"15483367827886667"</span><span class="token punctuation">,</span>
                <span class="token string">"uuid"</span><span class="token operator">:</span><span class="token string">"my-uuid"</span><span class="token punctuation">,</span>
                <span class="token string">"message_type"</span><span class="token operator">:</span><span class="token keyword keyword-null">null</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Other Examples</h3><ol class="ol-margin-extra"><li><p>Fetch messages with metadata and actions</p>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">fetchMessages</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channels</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'my_channel'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">stringifiedTimeToken</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">includeMeta</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">includeMessageActions</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token pn-variable">status</span><span class="token punctuation">,</span> <span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle status, response</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<p>Fetch messages with metadata and actions Response</p>

<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment">// Example of status</span>
<span class="token punctuation">{</span>
    <span class="token string">"error"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"operation"</span><span class="token operator">:</span> <span class="token string">"PNFetchMessagesOperation"</span><span class="token punctuation">,</span>
    <span class="token string">"statusCode"</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span>

<span class="token comment">// Example of response</span>
<span class="token punctuation">{</span>
    <span class="token string">"channels"</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string">"my_channel"</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"timetoken"</span><span class="token operator">:</span><span class="token string">"15741125155552287"</span><span class="token punctuation">,</span>
                <span class="token string">"message"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">"text"</span><span class="token operator">:</span><span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
                    <span class="token string">"uuid"</span><span class="token operator">:</span><span class="token string">"my-uuid"</span><span class="token punctuation">,</span>
                    <span class="token string">"message_type"</span><span class="token operator">:</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span>
                    <span class="token string">"meta"</span><span class="token operator">:</span><span class="token string">""</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"data"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">"reaction"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                        <span class="token string">"smiley_face"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                            <span class="token punctuation">{</span>
                                <span class="token string">"uuid"</span><span class="token operator">:</span><span class="token string">"my-uuid"</span><span class="token punctuation">,</span>
                                <span class="token string">"actionTimetoken"</span><span class="token operator">:</span><span class="token string">"15741125155943280"</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li></ol><hr><h2 class="inpage-link tag-link main-placeholder inline">Delete Messages from History</h2><div class="custom-popup-main"><span class="popup-button">Requires <i>Storage &amp; Playback</i> add-on</span><span class="popup-content"> <a title="Close" href="javascript:void(0)" class="custom-popup-close">X</a><span class="inner-content">Requires that the Storage &amp; Playback add-on is enabled for your key. See this page on enabling add-on features on your keys:<br><br><a href="/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys" target="_blank" title="Open in New window">http://www.pubnub.com/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys</a>.</span></span></div><h3 class="inpage-link tag-link">Description</h3><div>Removes the messages from the history of a specific channel.</div><table class="table-icon-note"><tbody><tr><td class="icon"><i class="fa icon icon-note" title="note">&nbsp;</i></td><td><div>There is a setting to accept delete from history requests for a key, which you must enable by checking the Enable <code>Delete-From-History</code> checkbox in the key settings for your key in the Admin Portal.</div><br><p>Requires Initialization with secret key.</p></td></tr></tbody></table><h3 class="inpage-link tag-link">Method(s)</h3><div>To <code>Delete Messages from History</code> you can use the following method(s) in the JavaScript V4 SDK.</div><table class="table-icon-note"><tbody><tr><td class="icon"><i class="fa icon icon-note" title="note">&nbsp;</i></td><td>The Delete Messages method behaves slightly differently than other history methods. Note that the <code>start</code> parameter is exclusive and the <code>end</code> parameter is inclusive.</td></tr></tbody></table><ol class="ol-margin-extra"><li class="list-inline"><div><code class="inpage-plink tag-link padding-left-0"><a href="#remove-the-messages-from-history-arg-1" data-id="remove-the-messages-from-history-arg-1-" title="Remove the messages from history Argument 1" class="title-red" id="remove-the-messages-from-history-arg-1-">deleteMessages(<span class="margin-left-1">{String <code>channel</code>, String <code>start</code>, String <code>end</code>},</span><span class="margin-left-1">Function <code>callback</code></span>)</a></code></div><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>Operation Arguments</td><td>Hash</td><td>Yes</td><td>A hash of arguments.</td></tr><tr><td><code class="margin-left-1">channel</code></td><td>String</td><td>Yes</td><td>Specifies <code>channel</code> messages to be deleted from history.</td></tr><tr><td><code class="margin-left-1">start</code></td><td>String</td><td>Optional</td><td>Time token delimiting the <code>start</code> of time slice (exclusive) to delete messages from.</td></tr><tr><td><code class="margin-left-1">end</code></td><td>String</td><td>Optional</td><td>Time token delimiting the <code>end</code> of time slice (inclusive) to delete messages from.</td></tr><tr><td><code>callback</code></td><td>Function</td><td>Optional</td><td>Is called on successful or unsuccessful execution of <code>deleteMessages</code>.</td></tr></tbody></table></div></li></ol><h3 class="inpage-link tag-link">Basic Usage</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">deleteMessages</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'ch1'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">'15088506076921021'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">'15088532035597390'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">result</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Response</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">operation</span><span class="token operator">:</span> <span class="token string">'PNDeleteMessagesOperation'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">statusCode</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Other Examples</h3><ol class="ol-margin-extra"><li><div class="inpage-plink tag-link"><a href="#delete-one-messages-from-history-with-timetoken" data-id="delete-messages-from-history-with-timetoken-" title="Delete one message from history" class="title-red" id="delete-messages-from-history-with-timetoken-">Delete specific message from history</a></div><br><div>To delete a specific message, pass the <code>publish timetoken</code> (received from a successful publish) in the <code>End</code> parameter and <code>timetoken +/- 1</code> in the <code>Start</code> parameter. e.g. if <code>15526611838554310</code> is the <code>publish timetoken</code>, pass <code>15526611838554309</code> in <code>Start</code> and <code>15526611838554310</code> in <code>End</code> parameters respectively as shown in the following code snippet.</div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">deleteMessages</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channel</span><span class="token operator">:</span> <span class="token string">'ch1'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">start</span><span class="token operator">:</span> <span class="token string">'15526611838554310'</span><span class="token punctuation">,</span>
        <span class="token pn-variable pn-before-colon">end</span><span class="token operator">:</span> <span class="token string">'15526611838554309'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">result</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li></ol><hr><h2 class="inpage-link tag-link main-placeholder inline">Message Counts</h2><div class="custom-popup-main"><span class="popup-button">Requires <i>Storage &amp; Playback</i> add-on</span><span class="popup-content"> <a title="Close" href="javascript:void(0)" class="custom-popup-close">X</a><span class="inner-content">Requires that the Storage &amp; Playback add-on is enabled for your key. See this page on enabling add-on features on your keys:<br><br><a href="/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys" target="_blank" title="Open in New window">http://www.pubnub.com/knowledge-base/discussion/644/how-do-i-enable-add-on-features-for-my-keys</a>.</span></span></div><h3 class="inpage-link tag-link">Description</h3><div>Returns the number of messages published on one or more channels since a given time. The <code>count</code> returned is the number of messages in history with a <code>timetoken</code> value <code>greater</code> than the passed value in the <code>channelTimetokens</code>parameter.</div><table class="table-icon-note"><tbody><tr><td class="icon"><i class="fa icon icon-note" title="note">&nbsp;</i></td><td>For keys with unlimited message retention enabled, this method considers only messages published in the last 7 days.</td></tr></tbody></table><h3 class="inpage-link tag-link">Method(s)</h3><div>You can use the following method(s) in the JavaScript V4 SDK:</div><ol class="margin-extra"><li class="list-inline"><div><code class="inpage-plink tag-link block"><a href="#message-counts-arg-1" data-id="message-counts-arg-1-" class="title-red" id="message-counts-arg-1-">messageCounts(<span class="margin-left-1">{Array <code>channels</code>, Array <code>channelTimetokens</code>},</span><span class="margin-left-1">Function <code>callback</code></span>)</a></code></div><div class="table-responsive"><table class="table table-striped"><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Defaults</th><th>Description</th></tr></thead><tbody><tr><td>Operation Arguments</td><td>Hash</td><td>Yes</td><td></td><td>A hash of arguments.</td></tr><tr><td><code class="margin-left-1">channels</code></td><td>Array</td><td>Yes</td><td></td><td>The <code>channels</code> to fetch the message count</td></tr><tr><td><code class="margin-left-1">channel<wbr>Timetokens</code></td><td>Array</td><td>Yes</td><td></td><td>List of <code>timetokens</code>, in order of the channels list. Specify a single <code>timetoken</code> to apply it to all channels. Otherwise, the list of <code>timetokens</code> must be the same length as the list of channels, or the function returns a <code>PNStatus</code>with an error flag.</td></tr><tr><td><code>callback</code></td><td>Function</td><td>Optional</td><td></td><td>Is called on successful or unsuccessful execution of <code>messageCounts</code>.</td></tr></tbody></table></div></li></ol><h3 class="inpage-link tag-link">Basic Usage</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">messageCounts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">channels</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"chats.room1"</span><span class="token punctuation">,</span> <span class="token string">"chats.room2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token pn-variable pn-before-colon">channelTimetokens</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'15518041524300251'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle error</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Returns</h3><table class="table-icon-note"><tbody><tr><td class="icon"><i class="fa icon icon-note" title="note">&nbsp;</i></td><td><code>Channels</code> without messages have a count of 0. <code>Channels</code> with 10,000 messages or more have a count of 10000.</td></tr></tbody></table>

<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
    <span class="token pn-variable pn-before-colon">channels</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token pn-variable pn-before-colon">ch1</span><span class="token operator">:</span> <span class="token number">49</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Status Response</h3>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token punctuation">{</span> 
    <span class="token pn-variable pn-before-colon">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">operation</span><span class="token operator">:</span> <span class="token string">'PNMessageCountsOperation'</span><span class="token punctuation">,</span>
    <span class="token pn-variable pn-before-colon">statusCode</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h3 class="inpage-link tag-link">Other Examples</h3><ol class="ol-margin-extra"><li><div class="inpage-plink tag-link"><a href="#message-counts-ch-timetoken" data-id="message-counts-ch-timetoken-" title="Retrieve count of messages using different timetokens for each channel" class="title-red" id="message-counts-ch-timetoken-">Retrieve count of messages using different timetokens for each channel</a></div>
<div class="code-toolbar"><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token pn-variable">pubnub</span><span class="token punctuation">.</span><span class="token function">messageCounts</span><span class="token punctuation">(</span>
	<span class="token punctuation">{</span>
		<span class="token pn-variable pn-before-colon">channels</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ch1'</span><span class="token punctuation">,</span> <span class="token string">'ch2'</span><span class="token punctuation">,</span> <span class="token string">'ch3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token pn-variable pn-before-colon">channelTimetokens</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'15495750401727535'</span><span class="token punctuation">,</span> <span class="token string">'15495750401727536'</span><span class="token punctuation">,</span> <span class="token string">'15495750401727537'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">response</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token pn-variable">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token pn-variable">response</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter pn-before-equal-greater"><span class="token pn-variable">error</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle error</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
</li></ol>